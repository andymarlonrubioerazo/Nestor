---
title: "EDA"
<<<<<<< HEAD
output: html_notebook
editor_options: 
  markdown: 
    wrap: 72
=======
output:
  html_document:
    df_print: paged
>>>>>>> 16a0e5d045a195ca5c3f5f437c1fe49e9633df67
---

## Preliminares

```{r}
library(tidyverse)
library(magrittr)
library(skimr)
library(janitor)
```

### Importacion

```{r}
data <- read_csv('Data/WA_Fn-UseC_-Telco-Customer-Churn.csv')
```

#### Verificar y corregir columnas

```{r}
data %>% glimpse
```

```{r}
data %>% 
  mutate(
    SeniorCitizen= factor(SeniorCitizen, levels= c(0, 1), 
                             labels= c('no', 'si') )
  ) ->
  data
```

# EDA

## EDA Univariado

```{r}
skim(data)
```

```{r}
data %>% 
  reframe( 
    tibble(
      Descrip= c('P_0', 'P_02', 'P_25', 'P_50' , 'P_75', 'P_98', 'P_100') ,
      Valor= quantile( TotalCharges, c(0, 0.2, 0.25, 0.50 ,0.75, 0.98, 1), na.rm= T)
    )
    )
```

<<<<<<< HEAD
## EDA Multivariado
=======

## EDA Bivariado
>>>>>>> 16a0e5d045a195ca5c3f5f437c1fe49e9633df67

### Room 2

#### Genero vs Churn

**Tabla**

```{r}

```

**Grafico**

```{r}

```

**Interpretacion**

#### PhoneService vs Churn

```{r}

```

**Interpretacion**

### Room 4

<<<<<<< HEAD
### Room 6

=======
#### SeniorCitizen vs Churn

**Tabla**

```{r}
data %>%
  group_by(SeniorCitizen, Churn) %>%
  summarise(
    N = n(),
    Porc = round(100*N/nrow(data),2)
  ) %>%
  mutate(Porc_grupo = round(100*N/sum(N),2)) -> valores_Sc

```

```{r echo=T}
tigerstats::rowPerc(xtabs(~SeniorCitizen+Churn, data=data) )
```

**Gráfico**

```{r}
ggplot(valores_Sc, aes(x = SeniorCitizen, y = N, fill = Churn)) +
  geom_col(stat = "identity", position = "dodge") +
  geom_text(aes(label = N), vjust = 1.5,
            position = position_dodge(.9))
```

**Interpretación**

De los adultos mayores el 41% abandonó el servicio, mientras que de los no adultos mayores apenas un 24% abandonó el servicio. Aparentemente, un adulto mayor tiene mayor probabilidad de abandonar el servicio. 

#### MultipleLines vs Churn

**Tabla**

```{r}
data %>%
  group_by(MultipleLines, Churn) %>%
  summarise(
    N = n(),
    Porc = round(100*N/nrow(data),2)
  ) %>%
  mutate(Porc_grupo = round(100*N/sum(N),2)) -> valores_Ml

```

```{r echo=T}
tigerstats::rowPerc(xtabs(~MultipleLines+Churn, data=data) )
```

**Gráfico**

```{r}
ggplot(valores_Ml, aes(x = MultipleLines, y = N, fill = Churn)) +
  geom_col(stat = "identity", position = "dodge") +
  geom_text(aes(label = N), vjust = 1.5,
            position = position_dodge(.9))
```


**Interpretación**

Entre las categorías de MultipleLines no hay mayor diferencia, entre los que abandonan o no el servicio. Los porcentajes son muy parecidos. 


#### TechSupport vs Churn

```{r}
data %>%
  group_by(TechSupport, Churn) %>%
  summarise(
    N = n(),
    Porc = round(100*N/nrow(data),2)
  ) %>%
  mutate(Porc_grupo = round(100*N/sum(N),2)) -> valores_Ts

```

```{r echo=T}
tigerstats::rowPerc(xtabs(~TechSupport+Churn, data=data) )
```

**Gráfico**

```{r}
ggplot(valores_Ts, aes(x = TechSupport, y = N, fill = Churn)) +
  geom_col(stat = "identity", position = "dodge") +
  geom_text(aes(label = N), vjust = 1.5,
            position = position_dodge(.9))
```

**Interpretación**

Los que no cuentan con soporte técnico, el 41.68% abandona el servicio. Por otro lado, los que si cuentan con soporte apenas un 15.17% abandona el servicio y los que no tienen internet contratado solo un 7.40% abandona el servicio.


#### PaymentMethod vs Churn

```{r}
data %>%
  group_by(PaymentMethod, Churn) %>%
  summarise(
    N = n(),
    Porc = round(100*N/nrow(data),2)
  ) %>%
  mutate(Porc_grupo = round(100*N/sum(N),2)) -> valores_Pm

```

```{r echo=T}
tigerstats::rowPerc(xtabs(~PaymentMethod+Churn, data=data) )
```

**Gráfico**

```{r}
ggplot(valores_Pm, aes(x = PaymentMethod, y = N, fill = Churn)) +
  geom_col(stat = "identity", position = "dodge") +
  geom_text(aes(label = N), vjust = 1.5,
            position = position_dodge(.9))
```

**Interpretación**
 
A excepción de los que pagan con cheque electrónico los porcentajes de abandono son muy parecidos. En el caso de los que pagan con cheque electrónico un 45.29% abandona el servicio.

### Room 6




### Room 8

#Eda Bivariado entre churn y Dependents


```{r}
data %>% tabyl(Churn, Dependents ) -> t1

t1 %>% adorn_totals(c("row", "col")) %>% adorn_percentages("all") %>%
adorn_pct_formatting(rounding = "half up", digits = 0) %>% adorn_ns() %>%
  adorn_title("combined") %>% knitr::kable()

data %>% count(Churn, Dependents) %>% mutate(porc = n / sum(n)) %>%
ggplot(aes(Dependents, n, fill = Churn)) + geom_bar(stat = 'identity') +
geom_text(aes(label = scales::percent(porc), y = n, vjust = 1)) +
labs(title = "Churn vs Dependents", x = "Dependents", y = "Count") +
theme_minimal()


```




#Eda Bivariado entre churn y OnlineSecurity


```{r}


data %>% tabyl(Churn,OnlineSecurity ) -> t2

t2 %>% adorn_totals(c("row", "col")) %>% adorn_percentages("all") %>%
adorn_pct_formatting(rounding = "half up", digits = 0) %>% adorn_ns()%>% adorn_title("combined")%>% knitr::kable()

data %>% count(Churn, OnlineSecurity) %>% mutate(porc = n / sum(n)) %>%
  ggplot(aes(OnlineSecurity, n, fill = Churn)) + geom_bar(stat =
'identity') + geom_text(aes(label = scales::percent(porc), y = n, vjust
= 1)) + labs(title = "Churn vs OnlineSecurity", x = "OnlineSecurity", y
= "Count")


```

#Eda Bivariado entre churn y Total Charges

```{r}

data %>%  group_by(Churn) %>% 
  summarise(n = n(),
            promedio = mean(TotalCharges,na.rm = T),
            n_missing = sum(is.na(TotalCharges)),
            desv = sd(TotalCharges, na.rm =T)) -> t4
t4

data %>%
  ggplot(aes(x = Churn, y = TotalCharges, fill = Churn)) +
  geom_boxplot() +
  stat_summary(fun = mean, geom = "point", shape = 3, size = 3, color = "white", position = position_dodge(width = 0.75)) +
  labs(title = "Churn vs Total Charges",
       x = "Churn",
       y = "Total Charges")

```




### Room 9

### Room 10


## EDA Multivariado


### Room 4

####  MonthlyCharges vs PaymentMethod vs Churn

**Gráfico 1**

```{r}
ggplot(data, aes(x = PaymentMethod, y = MonthlyCharges, fill = Churn)) +
  geom_boxplot()
```
**Interpretación**


**Gráfico 2**

```{r}
ggplot(data, aes(x = Churn, y = MonthlyCharges, fill = PaymentMethod)) +
  geom_boxplot()
```
**Interpretación**

Los montos de pago de aquellos que abandonan el servicio son superiores a aquellos que permanecen con excepción de los que pagan por cheque electrónico. 
>>>>>>> 16a0e5d045a195ca5c3f5f437c1fe49e9633df67
